{% extends "accounts/settings_base.html" %}
{% load i18n %}
{% load staticfiles %}


{% block page_title %}{% trans "Profile Settings" %}{% endblock %}

{% block profile_active %}active{% endblock %}

{% block settings_content %}
<div class="account-wrapper">
    <form action="" method="post" enctype="multipart/form-data">
    {% csrf_token %}

        <table class="profile-table">
            <tbody>
                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "First Name" %}
                        </strong>
                    </td>
                    <td>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div>
                                <span class="form-error">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    {{ form.first_name.errors }}
                                </span>
                            </div>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "Last Name" %}
                        </strong>
                    </td>
                    <td>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div>
                                <span class="form-error">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    {{ form.last_name.errors }}
                                </span>
                            </div>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "Biography" %}
                        </strong>
                    </td>
                    <td class="profile-bio">
                        {{ form.bio }}
                    </td>
                </tr>

                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "Connect Preferences" %}
                        </strong>
                    </td>
                    <td class="profile-preferences">
                        {{ form.preferences }}
                        {% if form.preferences.errors %}
                            <div>
                                <span class="form-error">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    {{ form.preferences.errors }}
                                </span>
                            </div>
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "Skills" %}
                        </strong>
                    </td>
                    <td class="profile-skills">
                        {{ skill_formset.management_form }}
                        {% for form in skill_formset %}
                            <div class="skill-formset">
                                {{ form.skill }}
                                <span class="divider">
                                    <i class="fa fa-arrows-h"></i>
                                </span>
                                {{ form.proficiency }}
                            </div>
                        {% endfor %}

                        {% if skill_formset.non_form_errors %}
                            <div>
                                <span class="form-error">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    {{ skill_formset.non_form_errors }}
                                </span>
                            </div>
                        {% endif %}

                    </td>
                </tr>

                <tr>
                    <td class="profile-heading">
                        <strong>
                            {% trans "Links" %}
                        </strong>
                    </td>
                    <td class="profile-links">
                        {{ link_formset.management_form }}
                        {% for form in link_formset %}
                            <div class="link-formset">
                                {{ form.anchor }}
                                <span class="divider">
                                    <i class="fa fa-arrows-h"></i>
                                </span>
                                {{ form.url }}
                            </div>
                        {% endfor %}

                        {% if link_formset.non_form_errors %}
                            <div>
                                <span class="form-error">
                                    <i class="fa fa-exclamation-triangle"></i>
                                    {{ link_formset.non_form_errors }}
                                </span>
                            </div>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <input type="submit" value="{% trans 'Update Profile Settings' %}" class="button"/>
                    </td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
{% endblock %}


{% block extra_js %}
    <script src="{% static 'js/vendor/jquery.autosize.min.js' %}"></script>
    <script src="{% static 'js/vendor/jquery.formset.js' %}"></script>

    <script>
        // Add additional fields to formsets
        $('.skill-formset').formset({
            prefix: '{{ skill_formset.prefix }}',
            formCssClass: 'dynamic-skill-formset',
            addText: '{% trans "add skill" %}',
            deleteText: '{% trans "remove" %}'
        });

        $('.link-formset').formset({
            prefix: '{{ link_formset.prefix }}',
            formCssClass: 'dynamic-link-formset',
            addText: '{% trans "add link" %}',
            deleteText: '{% trans "remove" %}'
        });


        // Enable fancy hover/focus CSS
        $('.bio, .account-input').on('blur', function(){
            $(this).addClass('inactive');
        }).on('focus', function(){
            $(this).removeClass('inactive');
        });

        // Set bio textarea width based on container
        var bioContainerWidth = $('td.profile-bio').width();

        $('.bio').css({
            width: bioContainerWidth - 20 // accounts for padding
        })

        // Fancy vertical resizing
        $('.bio').autosize();

    </script>
{% endblock %}
